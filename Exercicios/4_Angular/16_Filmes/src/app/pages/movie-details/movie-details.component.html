<section class="movie-details-component">

<app-header [movie]="movie">
    <ng-container title>
        {{movie?.title}}
    </ng-container>

    <ng-container icon>
        <app-badge class="star-badge work-sans font-36" >
            <ng-container content >
                <i class="pe-3 bi bi-star-fill text-warning"></i>
                <p class="m-0 font-bold" >{{movie?.vote_average?.toFixed(1)}}</p>
            </ng-container>
        </app-badge>
    </ng-container>
</app-header>



<section class="d-flex flex-lg-row flex-column ">
    <!-- Card da Imagem, Nome do Diretor e Data do Filme -->
    <app-white-card class="movie-detail-image">
        <ng-container content>
            <div class="d-flex flex-column flex-xl-row">

                <div class="d-flex flex-column p-3">
                    <img src="{{getImagesUrl()}}{{movie?.poster_path}}" class="image-border ">
                   
                    <!-- Note Badge / Nome do Autor e Data do Filme -->
                    <div class="d-flex mt-3 align-items-center">
                        <!-- Alguma bruxaria faz com que, quando ponho a classe de bold, ele remove o Bold -->
                        
                        <div class="d-flex flex-column">
                            <p class="m-0 inter">Dirigido por <b>{{director}}

                                @for (director of credits?.crew; track $index) 
                                {
                                    @if(director.job == "Director"){
                                        {{director.name}}
                                    }
                                }

                            </b></p>
                            <p class="m-0 inter">Lançado em {{ movie?.release_date| date:'longDate'}}</p>
                        </div>
                    </div>
                    <!-- Note Badge / Nome do Autor e Data do Filme -->
                </div>

                


                <!-- Genre Badges -->
                <div class="badges-genres d-flex flex-wrap align-content-start">
                    @for (genres of movie?.genres; track $index)
                    {
                        <app-badge class="gender-badge inter font-20 mt-3">
                            <ng-container content >
                                <p class="m-0 font-bold">{{genres.name}}</p>
                            </ng-container>
                        </app-badge>
                    }
                </div>
                <!-- Genre Badges -->
            </div>



            
            
        </ng-container>
    </app-white-card>
    <!-- Card da Imagem, Nome do Diretor e Data do Filme -->

    <!-- Atores e Sinopse -->
    <div class="movie-detail-actors d-flex flex-column">
        <app-white-card class="pb-4 pt-1 pt-sm-0">
            <ng-container content>
                <div class="d-flex flex-column p-3 w-100">
                    <h4 class="work-sans font-24 font-bold">
                        Elenco
                    </h4>
    
                    <!-- Atores -->
                     <div class="row">
                        @for (actor of getCastSliced(); track $index)
                        {
                            <app-avatar class="col-12 col-md-6 col-lg-12 col-xxl-6 pt-0 pt-3" [actor]="actor" nameClassName="font-bold" imageClassName="height-4">
                                <ng-container name>
                                    {{actor.character}}
                                </ng-container>
                                    
                                <ng-container subName>
                                    {{actor.name}}
                                </ng-container>
                            </app-avatar>
                        }
                     </div>
                    <!-- Atores -->
                     
                    <div class="d-flex justify-content-end">
                        <button type="button" class="custom-movies-button see-more-actors blue" data-bs-toggle="modal" data-bs-target="#actorsModal">
                            Ver Mais +
                        </button>
                    </div>
                </div>
            </ng-container>
        </app-white-card>
        

        <!-- Sinopse -->
        <app-white-card class="">
            <ng-container content>
                <div class="p-3">
                    <h3 class="work-sans font-24 font-bold">Sinopse</h3>
                    <p class="work-sans">
                        {{movie?.overview}}
                    </p>
                </div>
            </ng-container>
        </app-white-card>
        <!-- Sinopse -->
    </div>
    <!-- Atores e Sinopse -->
</section>

<section class="d-flex flex-wrap">
    @for (review of reviews; track $index)
    {
        <app-review [review]="review" class="pt-4"/>
    }
</section>


<!-- Novo Registro de Usuário -->
<section class="pt-2" >
    <form [formGroup]="newRegister" (ngSubmit)="submitRegister()">
        <legend>Registrar</legend>
        <div>
            <label for="name" >Nome: </label>
            <input id="name" name="name" type="text" formControlName="name" [(ngModel)]="nameModel">

            <p *ngIf="newRegister.get('name')?.invalid && newRegister.get('name')?.touched" class="text-danger">
                Insira um nome com pelo menos 3 caracteres.
            </p>
        </div>
  
        <div>
            <label for="email" >Email: </label>
            <input id="email" name="email" type="text" formControlName="email" [(ngModel)]="emailModel">

            <p *ngIf="newRegister.get('email')?.invalid && newRegister.get('email')?.touched" class="text-danger">
                Insira um email válido.
            </p>
        </div>

          <button type="submit" [disabled]="newRegisterInvalid">Registrar</button>
    </form>
</section>


<!-- Nova Review -->
<section class="pt-2" >
    <form [formGroup]="newReview" (ngSubmit)="submitReview()">
        <legend>Registrar</legend>
        <div>
            <label for="reviewContent" >Review: </label>
            <input id="reviewContent" name="reviewContent" type="text" formControlName="reviewContent" [(ngModel)]="reviewContentModel">

            <p *ngIf="newReview.get('reviewContent')?.invalid && newReview.get('reviewContent')?.touched" class="text-danger">
                Insira um review com pelo menos 3 caracteres.
            </p>
        </div>

        <div>
            <label for="watchedDate" >Data: </label>
            <input id="watchedDate" name="watchedDate" type="text" formControlName="watchedDate" [(ngModel)]="watchedDateModel">

            <p *ngIf="newReview.get('watchedDate')?.invalid && newReview.get('watchedDate')?.touched" class="text-danger">
                Insira uma data.
            </p>
        </div>

        <div>
            <label for="rating" >Nota: </label>
            <input id="rating" name="rating" type="text" formControlName="rating" [(ngModel)]="ratingModel">

            <p *ngIf="newReview.get('rating')?.invalid && newReview.get('rating')?.touched" class="text-danger">
                Insira uma Nota.
            </p>
        </div>






          <button type="submit" [disabled]="newReviewInvalid">Enviar Review</button>
    </form>

</section>
























</section>





















<app-modal [id]="'actorsModal'">
    <ng-container modalTitle>
        <b>Elenco</b>
    </ng-container>

    <ng-container modalContent>
        <div class="row">
            @for (actor of getCast(); track $index)
            {
                <div class="col-sm-6 col-lg-4 col-12 p-1">
                    <app-avatar class="pt-0 pt-3" [actor]="actor" nameClassName="font-bold" imageClassName="height-4">
                        <ng-container name>
                            {{actor.character.substring(0, nameLength)}}
                        </ng-container>
                            
                        <ng-container subName>
                            {{actor.name.substring(0, nameLength)}}
                        </ng-container>
                    </app-avatar>
                </div>
            }
        </div>


        <h5 class="mt-5"><b>Equipe de Produção</b></h5>

        <div class="modal-footer mt-4">
        </div>

        <div class="row">
            @for (crew of getCrew(); track $index)
            {
                <div class="col-sm-6 col-lg-4 col-12 p-1">
                    <app-avatar class="pt-0 pt-3" [crew]="crew" nameClassName="font-bold" imageClassName="height-4">
                        <ng-container name>
                            {{crew.name}}
                        </ng-container>
                    </app-avatar>
                </div>
            }
        </div>
    </ng-container>
</app-modal>